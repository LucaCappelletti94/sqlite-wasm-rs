SQLITE_OPT.common := \
  -DSQLITE_THREADSAFE=0 \
  -DSQLITE_TEMP_STORE=2 \
  -DSQLITE_OS_OTHER \
  -DSQLITE_ENABLE_MATH_FUNCTIONS \
  -DSQLITE_USE_URI=1 \
  -DSQLITE_OMIT_DEPRECATED \
  -DSQLITE_OMIT_LOAD_EXTENSION \
  -DSQLITE_OMIT_SHARED_CACHE

SQLITE_OPT.full-featured := \
  -DSQLITE_ENABLE_BYTECODE_VTAB \
  -DSQLITE_ENABLE_DBPAGE_VTAB \
  -DSQLITE_ENABLE_DBSTAT_VTAB \
  -DSQLITE_ENABLE_FTS5 \
  -DSQLITE_ENABLE_MATH_FUNCTIONS \
  -DSQLITE_ENABLE_OFFSET_SQL_FUNC \
  -DSQLITE_ENABLE_PREUPDATE_HOOK \
  -DSQLITE_ENABLE_RTREE \
  -DSQLITE_ENABLE_SESSION \
  -DSQLITE_ENABLE_STMTVTAB \
  -DSQLITE_ENABLE_UNKNOWN_SQL_FUNCTION \
  -DSQLITE_ENABLE_COLUMN_METADATA

SQLITE_OPT := \
    $(SQLITE_OPT.common) \
    $(SQLITE_OPT.full-featured)

default:
	emcc $(SQLITE_OPT) sqlite3.c wasm-shim.c -o sqlite3.o -I. -r -Oz -lc
	emar rcs libsqlite3linked.a sqlite3.o
	emcc $(SQLITE_OPT) sqlite3.c -o sqlite3.o -I. -r -Oz
	emar rcs libsqlite3.a sqlite3.o
	rm sqlite3.o
